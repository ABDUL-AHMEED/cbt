<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CBT Admin - PIN Generator</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #f4f4f4; text-align: center; }
        .container { max-width: 400px; margin: auto; background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        input { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; box-sizing: border-box; }
        button { width: 100%; padding: 10px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .exam-slip { border: 2px dashed #000; padding: 15px; text-align: center; background: #fff; margin-top: 20px; font-family: 'Courier New', monospace; }
        .pin-box { font-size: 28px; font-weight: bold; background: #eee; padding: 5px; display: block; margin: 10px 0; border: 1px solid #000; }
        @media print { .no-print { display: none; } body * { visibility: hidden; } #printArea, #printArea * { visibility: visible; } #printArea { position: absolute; left: 0; top: 0; width: 100%; } }
    </style>
</head>
<body onload="checkAdmin()">

    <div class="container no-print">
        <h2>Admin Portal</h2>
        <input type="text" id="studentName" placeholder="Enter Student Name">
        <button onclick="createNewSlip()">GENERATE PIN & SLIP</button>
        <div id="statusList" style="margin-top: 20px; text-align: left; font-size: 14px;"></div>
    </div>

    <div id="printArea"></div>

    <script>
        // 1. Password Protection
        function checkAdmin() {
            let pass = prompt("Enter Admin Password:");
            if (pass !== "1234") { 
                alert("Access Denied");
                window.location.href = "index.html"; 
            }
            updateDashboard();
        }

        // 2. PIN & Time Generation Logic
        function createNewSlip() {
            const nameInput = document.getElementById('studentName');
            const name = nameInput.value.trim();
            
            if (!name) {
                alert("Please enter a name!");
                return;
            }

            const days = ["Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"];
            const randomDay = days[Math.floor(Math.random() * days.length)];
            const randomHour = Math.floor(Math.random() * (19 - 16 + 1)) + 16; // 4pm - 7pm
            const pin = Math.floor(100000 + Math.random() * 900000); 
            const expiry = Date.now() + (48 * 60 * 60 * 1000); // 48 hours

            const data = { name, pin, day: randomDay, time: randomHour + ":00", expires: expiry };

            // Save to LocalStorage (Browser memory)
            let db = JSON.parse(localStorage.getItem("exam_db")) || [];
            db.push(data);
            localStorage.setItem("exam_db", JSON.stringify(db));

            // Show the slip on the screen
            document.getElementById('printArea').innerHTML = `
                <div class="exam-slip">
                    <h3>MOCK CBT ENTRANCE SLIP</h3>
                    <p>Candidate: <strong>${data.name}</strong></p>
                    <p>Day: <strong>${data.day}</strong> | Time: <strong>${data.time}</strong></p>
                    <span class="pin-box">${data.pin}</span>
                    <p><small>Valid for 48 hours from generation</small></p>
                    <button class="no-print" onclick="window.print()">PRINT SLIP</button>
                </div>
            `;
            
            nameInput.value = ""; // Clear input
            updateDashboard(); // Update the "Next person" list
        }

        // 3. Notification/List of registered people
        function updateDashboard() {
            let db = JSON.parse(localStorage.getItem("exam_db")) || [];
            const listDiv = document.getElementById('statusList');
            if(db.length > 0) {
                let html = "<strong>Recently Generated:</strong><ul>";
                // Show the last 3 people generated
                db.slice(-3).reverse().forEach(s => {
                    html += `<li>${s.name} - ${s.day} (${s.time})</li>`;
                });
                html += "</ul>";
                listDiv.innerHTML = html;
            }
        }
    </script>
    </body>
</html>
